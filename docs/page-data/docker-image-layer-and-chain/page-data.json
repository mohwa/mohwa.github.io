{
    "componentChunkName": "component---src-templates-blog-post-js",
    "path": "/docker-image-layer-and-chain/",
    "result": {"data":{"site":{"siteMetadata":{"title":"Mohwa Blog"}},"markdownRemark":{"id":"c235fed8-7558-5877-9a3b-fb9777b78a82","excerpt":"이 글을 더 정확히 이해하기위해, 도커 중간 이미지 및 레이어를 먼저 읽어보시는것을 추천드립니다. 테스트 환경 OS: centos/7 Docker Version: 20.10.12 호스트 OS 및 Docker Version 에 따라, 이 글의 가 다를 수 있습니다. Where is…","html":"<p>이 글을 더 정확히 이해하기위해, <a href=\"/docker-intermediate-image\">도커 중간 이미지 및 레이어</a>를 먼저 읽어보시는것을 추천드립니다.</p>\n<p>테스트 환경</p>\n<ul>\n<li>\n<p>OS: centos/7</p>\n</li>\n<li>\n<p>Docker Version: 20.10.12</p>\n<blockquote>\n<p>호스트 OS 및 Docker Version 에 따라, 이 글의 <code class=\"language-text\">테스트 결과</code>가 다를 수 있습니다.</p>\n</blockquote>\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/38532483/where-is-var-lib-docker-on-mac-os-x\">Where is /var/lib/docker on Mac/OS X</a></li>\n<li><a href=\"https://memostack.tistory.com/3\">Mac 환경의 Docker 는 /var/lib/docker가 없다</a></li>\n</ul>\n</li>\n<li>\n<p>도커 <code class=\"language-text\">이미지</code> 및 <code class=\"language-text\">컨테이너</code>가 초기화되어있습니다.</p>\n</li>\n<li>\n<p>아래 <code class=\"language-text\">Dockerfile</code> 내용으로, <code class=\"language-text\">docker-layers:0.0.1</code> 이미지가 생성된것을 전제로합니다.</p>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre class=\"language-dockerfile\"><code class=\"language-dockerfile\"><span class=\"token instruction\"><span class=\"token keyword\">FROM</span> alpine:latest</span>\n<span class=\"token instruction\"><span class=\"token keyword\">RUN</span> echo first</span>\n<span class=\"token instruction\"><span class=\"token keyword\">COPY</span> ./second.txt .</span>\n<span class=\"token instruction\"><span class=\"token keyword\">ADD</span> ./third.txt .</span>\n<span class=\"token instruction\"><span class=\"token keyword\">CMD</span> [<span class=\"token string\">\"echo\"</span>, <span class=\"token string\">\"fourth\"</span>]</span></code></pre></div>\n<p><code class=\"language-text\">docker history</code> 명령으로 <code class=\"language-text\">중간 이미지</code>들의 <code class=\"language-text\">사이즈</code>를 확인합니다.</p>\n<ul>\n<li><a href=\"https://docs.docker.com/engine/reference/commandline/history/\">https://docs.docker.com/engine/reference/commandline/history/</a></li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"shellscript\"><pre class=\"language-shellscript\"><code class=\"language-shellscript\">[root@docker-test docker-layer]# docker history 6533a93ed3e4\n\nIMAGE          CREATED       CREATED BY                                      SIZE      COMMENT\n6533a93ed3e4   2 hours ago   /bin/sh -c #(nop)  CMD [&quot;echo&quot; &quot;fourth&quot;]        0B\n6b786cea2e12   2 hours ago   /bin/sh -c #(nop) ADD file:7db483be005ca26c6…   6B\n13b825a700e2   2 hours ago   /bin/sh -c #(nop) COPY file:932d2d37c43b3d37…   7B\nc1ee277ee0b6   2 hours ago   /bin/sh -c echo first                           0B\nc059bfaa849c   5 weeks ago   /bin/sh -c #(nop)  CMD [&quot;/bin/sh&quot;]              0B\n&lt;missing&gt;      5 weeks ago   /bin/sh -c #(nop) ADD file:9233f6f2237d79659…   5.59MB</code></pre></div>\n<p><code class=\"language-text\">docker image inspect</code> 명령으로, <code class=\"language-text\">이미지 레이어</code>들을 확인하면, 사이즈가 <code class=\"language-text\">0B</code> 초과인 항목들만, <code class=\"language-text\">이미지 레이어</code>로 추가되어있는것을 확인할 수 있습니다.</p>\n<ul>\n<li>즉, 컨테이너 <code class=\"language-text\">파일 시스템</code>에, 영향을 주는 항목들만, <code class=\"language-text\">이미지 레이어</code>로 추가됩니다.</li>\n</ul>\n<p><a href=\"https://docs.docker.com/engine/reference/commandline/image_inspect/\">https://docs.docker.com/engine/reference/commandline/image_inspect/</a></p>\n<img src=\"https://user-images.githubusercontent.com/11391606/148420106-91f804a1-d68f-436b-abf5-3c0affb11849.png\" width=\"700\">\n<div class=\"gatsby-highlight\" data-language=\"shellscript\"><pre class=\"language-shellscript\"><code class=\"language-shellscript\">[root@docker-test sha256]# docker image inspect 6533a93ed3e4\n\n[\n    {\n        &quot;Id&quot;: &quot;sha256:6533a93ed3e44b5cd1a2b915508dfeb99b54660405a33db5fce4593884cb64db&quot;,\n        ...\n        &quot;RootFS&quot;: {\n            &quot;Type&quot;: &quot;layers&quot;,\n            &quot;Layers&quot;: [\n                &quot;sha256:8d3ac3489996423f53d6087c81180006263b79f206d3fdec9e66f0e27ceb8759&quot;,\n                &quot;sha256:49825ee4ae566cd81659e8a56f3d87266bcbf8e098d6dfa6ba75b53582fdb64a&quot;,\n                &quot;sha256:35654cdb06748b1ee3474cd39ce940377b6fa47b657ea6e8f93b1f55c3af94eb&quot;\n            ]\n        },\n    }\n]</code></pre></div>\n<p><code class=\"language-text\">layerdb</code> 에 포함된 디렉토리 목록입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shellscript\"><pre class=\"language-shellscript\"><code class=\"language-shellscript\">[root@docker-test ~]# ls /var/lib/docker/image/overlay2/layerdb/sha256\n\n0c05e4dd4393920e9ae63e5c784f00084f12ab1414da5decaffb2da1275e1e0a\n8d3ac3489996423f53d6087c81180006263b79f206d3fdec9e66f0e27ceb8759\nc41ff8f7e1a31f45604ee0f6a1dbda09170df0a56c4054cb96fe81e3d344aa28</code></pre></div>\n<h2>도커 이미지 체인</h2>\n<img src=\"https://user-images.githubusercontent.com/11391606/148420102-d5c8baf3-267b-40be-a2fa-84cc1e5b9f5b.png\" height=\"800\">\n<p>생성된 모든 <code class=\"language-text\">이미지</code>들은, 모두 위와 같은 <code class=\"language-text\">부모/자식</code> 관계를 갖게됩니다.</p>\n<p>즉, 다음과 같은 <code class=\"language-text\">이미지</code>들이 있을 경우,</p>\n<blockquote>\n<p><code class=\"language-text\">/var/lib/docker/image/overlay2/imagedb/metadata/sha256</code> 에서 각 <code class=\"language-text\">이미지</code>들의 <code class=\"language-text\">parent</code>를 확인할 수 있습니다.</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"shellscript\"><pre class=\"language-shellscript\"><code class=\"language-shellscript\">[root@docker-test ~]# ls /var/lib/docker/image/overlay2/imagedb/metadata/sha256\n\n13b825a700e28b5643ec821757ec0a2b21f0531ec1bdbda6a33c2c8cd7afc4f9\n6533a93ed3e44b5cd1a2b915508dfeb99b54660405a33db5fce4593884cb64db\n6b786cea2e12553139d13f82ed9edbe3e30825b75b88d31f98eea758ed998e7f\nc059bfaa849c4d8e4aecaeb3a10c2d9b3d85f5165c66ad3a4d937758128c4d18\nc1ee277ee0b65261920b47bf211c74374706022a65dafc59d268ea17c31adfe5</code></pre></div>\n<p>각 <code class=\"language-text\">이미지</code>들이 가리키는 <code class=\"language-text\">parent</code> 를 확인해보면 다음과 같습니다.</p>\n<p><code class=\"language-text\">RUN echo first</code> 에 해당되는 이미지는, <code class=\"language-text\">alpine:latest</code> 이미지를 기반으로 생성되며, 그 이미지를 <code class=\"language-text\">parent</code> 로 바라보게됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shellscript\"><pre class=\"language-shellscript\"><code class=\"language-shellscript\">[root@docker-test sha256]# cat c1ee277ee0b65261920b47bf211c74374706022a65dafc59d268ea17c31adfe5/parent\n\n# alpine:latest\nsha256:c059bfaa849c4d8e4aecaeb3a10c2d9b3d85f5165c66ad3a4d937758128c4d18</code></pre></div>\n<p>또, <code class=\"language-text\">COPY ./second.txt .</code> 에 해당되는 이미지는, <code class=\"language-text\">RUN echo first</code> 이미지를 기반으로 생성되며, 그 이미지를 <code class=\"language-text\">parent</code> 로 바라보게됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shellscript\"><pre class=\"language-shellscript\"><code class=\"language-shellscript\">[root@docker-test sha256]# cat 13b825a700e28b5643ec821757ec0a2b21f0531ec1bdbda6a33c2c8cd7afc4f9/parent\n\n# RUN echo first\nsha256:c1ee277ee0b65261920b47bf211c74374706022a65dafc59d268ea17c31adfe5</code></pre></div>\n<p>즉, 모든 이미지들은, 모두 위와 같은 <code class=\"language-text\">부모/자식</code> 관계를 갖게되고, 이런 구조를 기반으로, <code class=\"language-text\">레이어 체인</code>이 만들어지게됩니다.</p>","frontmatter":{"title":"도커 이미지 레이어 및 체인","date":"January 09, 2022","description":""}},"previous":{"fields":{"slug":"/docker-build-cache/"},"frontmatter":{"title":"도커 빌드 캐시"}},"next":{"fields":{"slug":"/docker-intermediate-image/"},"frontmatter":{"title":"도커 중간 이미지 및 레이어"}}},"pageContext":{"id":"c235fed8-7558-5877-9a3b-fb9777b78a82","previousPostId":"9d166dc1-f238-596d-9436-e6c37c74ca73","nextPostId":"a7d6fdb9-c1cf-5298-8090-040e371c1492"}},
    "staticQueryHashes": ["2841359383","3257411868"]}